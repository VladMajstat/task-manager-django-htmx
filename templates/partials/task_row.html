<div id="project-{{ task.project_id }}-empty" hx-swap-oob="delete"></div>
<div class="app-task-row d-flex align-items-stretch gap-2 px-2 border-top{% if task.deadline and not task.is_done and due_soon_cutoff and task.deadline <= due_soon_cutoff %} app-task-due-soon{% endif %}"
     data-task-id="{{ task.id }}"
     data-deadline="{% if task.deadline %}{{ task.deadline|date:'Y-m-d' }}{% endif %}"
     data-done="{% if task.is_done %}1{% else %}0{% endif %}">

  <div class="pt-1 app-task-col app-task-col-check">
    {% comment %} Done checkbox: HTMX POST toggles done {% endcomment %}
    <input class="form-check-input app-task-check" type="checkbox" {% if task.is_done %}checked{% endif %}
      hx-post="{% url 'service:task_toggle_done' task.id %}"
      hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
      hx-target="closest .app-task-row"
      hx-swap="outerHTML"
    />
  </div>

  <div class="flex-grow-1 app-task-col app-task-col-text">
    <div class="app-task-text {% if task.is_done %}app-task-done{% endif %}">
      {{ task.name }}
    </div>
  </div>

  <!-- Task actions -->
  <div class="d-flex align-items-center gap-1 app-task-col app-task-col-actions">
    <div class="app-task-move-stack" role="group" aria-label="Move task">
      {% comment %} Move up button: HTMX POST swaps priorities {% endcomment %}
      <button
        class="btn btn-sm btn-link text-muted app-icon-btn app-task-move-btn"
        title="Move up"
        type="button"
        hx-post="{% url 'service:task_move' task.id 'up' %}"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-target="#project-{{ task.project_id }}-tasks"
        hx-swap="outerHTML"
      >
        ▲
      </button>
      <span class="app-task-move-divider" aria-hidden="true"></span>
      {% comment %} Move down button: HTMX POST swaps priorities {% endcomment %}
      <button
        class="btn btn-sm btn-link text-muted app-icon-btn app-task-move-btn"
        title="Move down"
        type="button"
        hx-post="{% url 'service:task_move' task.id 'down' %}"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-target="#project-{{ task.project_id }}-tasks"
        hx-swap="outerHTML"
      >
        ▼
      </button>
    </div>
    {% comment %} Edit button: HTMX GET shows the inline form {% endcomment %}
    <button
      class="btn btn-sm btn-link text-muted app-icon-btn"
      title="Edit"
      type="button"
      hx-get="{% url 'service:task_update' task.id %}"
      hx-target="closest .app-task-row"
      hx-swap="outerHTML"
    >
      <svg class="app-action-icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 17.25V21h3.75L19.81 7.94l-3.75-3.75L3 17.25z"></path>
        <path d="M20.71 6.04a1 1 0 000-1.41L19.37 3.3a1 1 0 00-1.41 0l-1.12 1.12 3.75 3.75 1.12-1.13z"></path>
      </svg>
    </button>
    {% comment %} Delete button: HTMX POST removes the task row {% endcomment %}
    <button
      class="btn btn-sm btn-link text-muted app-icon-btn"
      title="Delete"
      type="button"
      hx-post="{% url 'service:task_delete' task.id %}"
      hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
      hx-target="closest .app-task-row"
      hx-swap="delete"
      hx-confirm="Delete this task?"
      data-confirm="delete"
    >
      <svg class="app-action-icon" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M6 7h12l-1 14H7L6 7z"></path>
        <path d="M9 7V5h6v2"></path>
        <path d="M4 7h16"></path>
      </svg>
    </button>
  </div>
</div>
